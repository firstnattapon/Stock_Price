import streamlit as st
import streamlit.components.v1 as components 

# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
st.set_page_config(page_title="Longdo Map Streamlit", layout="wide")

st.title("üó∫Ô∏è Longdo Map with Streamlit")
st.caption("‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Longdo Map API ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö Streamlit ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ä‡∏±‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô")

# 1. ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞ Input ‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (Sidebar)
with st.sidebar:
    st.header("üìç ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î")
    
    # API Key
    api_key = st.text_input("Longdo API Key", value="0a999afb0da60c5c45d010e9c171ffc8")
    
    # ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
    lat = st.number_input("Latitude (‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î)", value=13.7469, format="%.6f")
    lon = st.number_input("Longitude (‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î)", value=100.5349, format="%.6f")
    zoom = st.slider("Zoom Level", 1, 20, 16)
    
    st.markdown("---")
    st.header("üóÇÔ∏è ‡∏ä‡∏±‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Layers)")
    
    # ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á
    show_traffic = st.checkbox("‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏≤‡∏à‡∏£", value=False)
    show_dol = st.checkbox("‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏±‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô (DOL)", value=True)
    
    st.info("üí° ‡∏ã‡∏π‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö 16-20 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô")

# 2. ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
longdo_map_html = f"""
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style>
        body {{ margin: 0; padding: 0; }}
        #map {{ height: 600px; width: 100%; }}
    </style>
    <script src="https://api.longdo.com/map/?key={api_key}"></script>
</head>
<body>
    <div id="map"></div>
    
    <script>
        var map;
        
        function init() {{
            try {{
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
                map = new longdo.Map({{
                    placeholder: document.getElementById('map'),
                    language: 'th'
                }});
                
                // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏à‡∏∏‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ã‡∏π‡∏°
                map.location({{ lon: {lon}, lat: {lat} }}, true);
                map.zoom({zoom}, true);

                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏∏‡∏î (Marker)
                var marker = new longdo.Marker({{ lon: {lon}, lat: {lat} }}, {{
                    title: '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å',
                    detail: 'Lat: {lat}<br>Lon: {lon}'
                }});
                map.Overlays.add(marker);
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏•‡πÄ‡∏¢‡∏≠‡∏£‡πå‡∏à‡∏£‡∏≤‡∏à‡∏£
                {f"map.Layers.add(longdo.Layers.TRAFFIC);" if show_traffic else "// Traffic layer disabled"}
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏±‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô (DOL)
                {f"map.Layers.add(longdo.Layers.DOL);" if show_dol else "// DOL layer disabled"}
                
                console.log('Map initialized successfully');
                console.log('Available layers:', longdo.Layers);
                
            }} catch(e) {{
                console.error('Error initializing map:', e);
            }}
        }}
        
        // ‡∏£‡∏≠‡πÉ‡∏´‡πâ DOM ‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à‡∏Å‡πà‡∏≠‡∏ô
        if (document.readyState === 'loading') {{
            document.addEventListener('DOMContentLoaded', init);
        }} else {{
            init();
        }}
    </script>
</body>
</html>
"""

# 3. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏î‡πâ‡∏ß‡∏¢ components.html
components.html(longdo_map_html, height=620)

# ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ï‡πâ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
col1, col2, col3 = st.columns(3)

with col1:
    st.metric("Latitude", f"{lat:.6f}")
with col2:
    st.metric("Longitude", f"{lon:.6f}")
with col3:
    st.metric("Zoom Level", zoom)

st.markdown("---")

# ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö Layers
with st.expander("‚ÑπÔ∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô"):
    st.markdown("""
    ### ‡∏ä‡∏±‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô (Department of Lands - DOL)
    
    **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á:**
    - üèòÔ∏è ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô
    - üìã ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡πÇ‡∏â‡∏ô‡∏î
    - üìç ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡πÅ‡∏õ‡∏•‡∏á
    - üó∫Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏≤‡∏á‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£
    
    **‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**
    1. ‡∏ã‡∏π‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö **16 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏´‡πá‡∏ô‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
    2. ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
    3. ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏ó‡∏µ‡πà zoom level 18-20
    
    **‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:**
    - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ó‡∏∏‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà
    - ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ API Key ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• DOL
    - ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏°‡∏´‡∏≤‡∏î‡πÑ‡∏ó‡∏¢
    """)

# ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏™‡∏î‡∏á Layers ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
st.subheader("üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Layers")
layer_status = {
    "Layer": ["‡∏à‡∏£‡∏≤‡∏à‡∏£ (Traffic)", "‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô (DOL)"],
    "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞": ["üü¢ ‡πÄ‡∏õ‡∏¥‡∏î" if show_traffic else "üî¥ ‡∏õ‡∏¥‡∏î", 
               "üü¢ ‡πÄ‡∏õ‡∏¥‡∏î" if show_dol else "üî¥ ‡∏õ‡∏¥‡∏î"]
}
st.table(layer_status)

st.success("‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡∏à‡∏≤‡∏Å Longdo API")

# ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
if show_dol and zoom < 16:
    st.warning("‚ö†Ô∏è ‡∏ä‡∏±‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ã‡∏π‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏î‡∏±‡∏ö 16 ‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ")
