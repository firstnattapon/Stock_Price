import streamlit as st
import folium
from streamlit_folium import st_folium

# --- 1. ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö ---
st.set_page_config(page_title="Longdo Map - DOL Layer", layout="wide")

st.title("üó∫Ô∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏π‡∏õ‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô (‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô)")
st.caption("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Longdo Map WMS Special Layers")

# --- 2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Parameters ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö WMS ---
API_KEY = "0a999afb0da60c5c45d010e9c171ffc8"
BASE_URL = "https://ms.longdo.com/mapproxy/service"

# ‡∏™‡∏£‡πâ‡∏≤‡∏á URL ‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏° Key (‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Longdo)
# ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö: https://ms.longdo.com/mapproxy/service?key=...
wms_full_url = f"{BASE_URL}?key={API_KEY}"

# --- 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏±‡∏Å (Base Map) ---
# ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏≠‡∏ô‡∏∏‡∏™‡∏≤‡∏ß‡∏£‡∏µ‡∏¢‡πå‡∏ä‡∏±‡∏¢‡∏Ø) ‡πÅ‡∏•‡∏∞ Zoom Level
# Note: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡∏°‡∏±‡∏Å‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏ä‡∏±‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠ Zoom ‡∏•‡∏∂‡∏Å‡πÜ (‡∏£‡∏∞‡∏î‡∏±‡∏ö 15+)
m = folium.Map(location=[13.7649, 100.5383], zoom_start=16)

# --- 4. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏±‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô (Base Layer) ---
# ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏ô‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á Longdo ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô
folium.WmsTileLayer(
    url=wms_full_url,
    layers='longdo_icons',  # ‡∏ä‡∏∑‡πà‡∏≠ Layer ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
    name='Longdo Road Map',
    fmt='image/png',
    transparent=False,
    attribution='¬© NuMAP, Longdo, OpenStreetMap'
).add_to(m)

# --- 5. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏±‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô (DOL Layer) ---
# ‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ (Special Layer)
folium.WmsTileLayer(
    url=wms_full_url,
    layers='dol',           # <--- ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠ Layer ‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏°‡∏≤‡πÑ‡∏î‡πâ (dol)
    name='Department of Lands (‡∏£‡∏π‡∏õ‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô)',
    fmt='image/png',        # ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏†‡∏≤‡∏û
    transparent=True,       # ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç! ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô True ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏™ ‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏ñ‡∏ô‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á
    version='1.1.1',
    attribution='Department of Lands / Longdo Map'
).add_to(m)

# ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î Layer
folium.LayerControl().add_to(m)

# --- 6. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô Streamlit ---
st_data = st_folium(m, width="100%", height=600)

# --- 7. ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡∏¥‡∏° ---
st.info("""
**‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô:**
1. **Zoom In:** ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡πâ‡∏ô‡πÅ‡∏ö‡πà‡∏á‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ã‡∏π‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡πÉ‡∏Å‡∏•‡πâ‡πÜ ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (Zoom Level ‡∏™‡∏π‡∏á‡πÜ)
2. **Layer Control:** ‡∏Å‡∏î‡∏ó‡∏µ‡πà‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô Layer ‡∏°‡∏∏‡∏°‡∏Ç‡∏ß‡∏≤‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡∏ä‡∏±‡πâ‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡πÑ‡∏î‡πâ
""")

# (Optional) ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏Å
if st_data['last_clicked']:
    lat = st_data['last_clicked']['lat']
    lng = st_data['last_clicked']['lng']
    st.success(f"üìç ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏Å: {lat}, {lng}")
