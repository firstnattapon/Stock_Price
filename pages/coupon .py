import streamlit as st
import pandas as pd
import random

# 1. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
st.set_page_config(
    page_title="Lucky Number Coupons",
    page_icon="üíé",
    layout="wide"
)

# 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡∏Ç‡∏ï‡∏≠‡∏á (11111 - 99999)
def generate_lucky_coupons():
    coupons = []
    # ‡∏•‡∏π‡∏õ‡πÄ‡∏•‡∏Ç 1 ‡∏ñ‡∏∂‡∏á 9
    for i in range(1, 10):
        # ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏Ç‡∏ï‡∏≠‡∏á 5 ‡∏´‡∏•‡∏±‡∏Å ‡πÇ‡∏î‡∏¢‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏•‡∏Ç‡πÄ‡∏õ‡πá‡∏ô string ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏π‡∏ì 5 (‡πÄ‡∏ä‡πà‡∏ô "1"*5 = "11111")
        code = str(i) * 5 
        
        # ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏à‡∏£‡∏¥‡∏á
        item = {
            "Coupon ID": f"VIP-{code}",
            "Code (‡πÄ‡∏•‡∏Ç‡∏ï‡∏≠‡∏á)": code,
            "Value (‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤)": 1000, # ‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤
            "Status": random.choice(["Available", "Used", "Reserved"]), # ‡∏™‡∏∏‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            "Type": "Platinum"
        }
        coupons.append(item)
    
    return pd.DataFrame(coupons)

# 3. ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏•‡∏±‡∏Å (Main Interface)
st.title("üíé ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÄ‡∏•‡∏Ç‡∏™‡∏ß‡∏¢ (VIP Lucky Numbers)")
st.markdown("‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏•‡∏Ç‡∏ï‡∏≠‡∏á **11111 - 99999**")
st.markdown("---")

# ‡∏™‡∏£‡πâ‡∏≤‡∏á Sidebar ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Filter
st.sidebar.header("üîç ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á")
status_filter = st.sidebar.multiselect(
    "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á",
    options=["Available", "Used", "Reserved"],
    default=["Available", "Used", "Reserved"]
)

# ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
df = generate_lucky_coupons()

# 4. ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Filter Logic)
if status_filter:
    df_show = df[df["Status"].isin(status_filter)]
else:
    df_show = df # ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏•‡∏¢ ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

# 5. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• Metric (‡∏™‡∏£‡∏∏‡∏õ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç)
c1, c2, c3 = st.columns(3)

with c1:
    st.metric("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", f"{len(df)} ‡πÉ‡∏ö")

with c2:
    st.metric("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•", f"{len(df_show)} ‡πÉ‡∏ö")

with c3:
    # ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏¢‡∏π‡πà
    total_val = df_show["Value (‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤)"].sum()
    st.metric("‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏° (‡∏ö‡∏≤‡∏ó)", f"{total_val:,}")

st.markdown("### üìã ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á")

# 6. ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
# ‡πÉ‡∏ä‡πâ st.data_editor ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏™‡∏ß‡∏¢‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏•‡πà‡∏ô‡πÑ‡∏î‡πâ (‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ã‡∏ü‡∏à‡∏£‡∏¥‡∏á)
st.data_editor(
    df_show,
    column_config={
        "Status": st.column_config.SelectboxColumn(
            "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞",
            options=["Available", "Used", "Reserved"],
            width="medium",
            required=True,
        ),
        "Value (‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤)": st.column_config.NumberColumn(
            "‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤ (‡∏ö‡∏≤‡∏ó)",
            format="%d ‡∏ø"
        ),
        "Code (‡πÄ‡∏•‡∏Ç‡∏ï‡∏≠‡∏á)": st.column_config.TextColumn(
            "‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á",
            help="‡πÄ‡∏•‡∏Ç‡∏ï‡∏≠‡∏á 5 ‡∏´‡∏•‡∏±‡∏Å",
        )
    },
    hide_index=True,
    use_container_width=True
)

# 7. ‡∏õ‡∏∏‡πà‡∏°‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Optional)
# ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ Import ‡πÄ‡∏Ç‡πâ‡∏≤ Firebase ‡∏à‡∏£‡∏¥‡∏á‡πÜ
csv = df_show.to_csv(index=False).encode('utf-8')
st.download_button(
    label="üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô CSV",
    data=csv,
    file_name="lucky_coupons_11111_99999.csv",
    mime="text/csv",
)

# Footer
st.markdown("---")
st.caption("Auto-generated by Smart Washer System | 11111-99999 Series")
